{% extends 'base2.html' %}
{% load static %}
{% static "images" as baseURL %}

{% block content %}
<style type="text/css">
  .profile-head {
    transform: translateY(5rem)
}

.cover {
    background-image: url(https://images.unsplash.com/photo-1530305408560-82d13781b33a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1352&q=80);
    background-size: cover;
    background-repeat: no-repeat
}

body {
    background: #654ea3;
    background: linear-gradient(to right, #e96443, #904e95);
    min-height: 100vh;
    overflow-x: hidden
}
</style>
{% for user in users %}
 <div class="row">
    <div class="col-md-10 mx-auto">
        <!-- Profile widget -->
        <div class="bg-white shadow rounded overflow-hidden">
            <div class="px-4 pt-0 pb-4 cover">
                <div class="media align-items-end profile-head">
                    {% if user.Profile_pic %}
                    <div class="profile mr-3"><img src="{{user.Profile_pic.url}}" alt="..." width="130" class="rounded mb-2 img-thumbnail"><a href="#" class="btn btn-outline-dark btn-sm btn-block">Edit profile</a></div>
                    {% else %}
                    <div class="profile mr-3"><img src="{% static 'images/blank-profile.png' %}" alt="..." width="130" class="rounded mb-2 img-thumbnail"><a href="#" class="btn btn-outline-dark btn-sm btn-block">Edit profile</a></div>
                    {% endif %}
                    <div class="media-body mb-5 text-white">
                        <h4 class="mt-0 mb-0" style="color:white;">{{user.Fullname}}</h4>
                        <p class="small mb-4"> <i class="fas fa-map-marker-alt mr-2"></i>{{user.address}}</p>
                    </div>
                </div>
            </div>
            <div class="bg-light p-4 d-flex justify-content-end text-center">
                <ul class="list-inline mb-0">
                    <li class="list-inline-item">
                        <h5 class="font-weight-bold mb-0 d-block">215</h5><small class="text-muted"> <i class="fas fa-image mr-1"></i>Photos</small>
                    </li>
                    <li class="list-inline-item">
                        <h5 class="font-weight-bold mb-0 d-block">745</h5><small class="text-muted"> <i class="fas fa-user mr-1"></i>Followers</small>
                    </li>
                    <li class="list-inline-item">
                        <h5 class="font-weight-bold mb-0 d-block">340</h5><small class="text-muted"> <i class="fas fa-user mr-1"></i>Following</small>
                    </li>
                </ul>
            </div>
            <div class="px-4 py-3">

<!--                <div class="p-4 rounded shadow-sm bg-light">-->
<!--                    <p class="font-italic mb-0">Web Developer</p>-->
<!--                    <p class="font-italic mb-0">Lives in New York</p>-->
<!--                    <p class="font-italic mb-0">Photographer</p>-->
<!--                </div>-->
              <div class="col-lg-8">
                  <div class="card">
                      <div class="card-body">
                          <form  id="updateProfileform"  enctype="multipart/form-data">
                              <div class="row mb-3">
                                  <div class="col-sm-3">
                                      <h6 class="mb-0">Full Name</h6>
                                  </div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="text" class="form-control" id="full_name" value="{{user.Fullname}}">
                                  </div>
                              </div>
                              <div class="row mb-3">
                                  <div class="col-sm-3">
                                      <h6 class="mb-0">Email</h6>
                                  </div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="text" class="form-control" id="email" value="{{user.Email}}">
                                  </div>
                              </div>
                              <div class="row mb-3">
                                  <div class="col-sm-3">
                                      <h6 class="mb-0">Phone</h6>
                                  </div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="tel" class="form-control" id="phne" pattern="[0-9]{10,10}" value="{{user.phone_no}}">
                                  </div>
                              </div>
                              <div class="row mb-3">
                                  <div class="col-sm-3">
                                      <h6 class="mb-0">Date Of Birth</h6>
                                  </div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="date" name="Date_of_Birth" id="dob" value="{{date_of_birth}}" class="form-control">
                                  </div>
                              </div>
                              <div class="row mb-3">
                                  <div class="col-sm-3">
                                      <h6 class="mb-0">Address</h6>
                                  </div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="text" class="form-control" id="address" value="{{user.address}}">
                                  </div>
                              </div>
                              <div class="row mb-3">
                                  <div class="col-sm-3">
                                      <h6 class="mb-0">Choose Profile Pic </h6>
                                  </div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="file" id="profile_pic" name="profile_pic" accept=".jpg, .jpeg, .png"  multiple>
                                  </div>
                              </div>


                              <div class="row">
                                  <div class="col-sm-3"></div>
                                  <div class="col-sm-9 text-secondary">
                                      <input type="submit" class="btn btn-primary px-4" value="Save Changes">
                                  </div>
                              </div>
                          </form>
                      </div>
                  </div>
              </div>

            </div>
            <div class="py-4 px-4">

                <div class="row">
                    <div class="col-lg-6 mb-2 pr-lg-1"><img src="https://images.unsplash.com/photo-1469594292607-7bd90f8d3ba4?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80" alt="" class="img-fluid rounded shadow-sm"></div>
                    <div class="col-lg-6 mb-2 pl-lg-1"><img src="https://images.unsplash.com/photo-1493571716545-b559a19edd14?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80" alt="" class="img-fluid rounded shadow-sm"></div>
                    <div class="col-lg-6 pr-lg-1 mb-2"><img src="https://images.unsplash.com/photo-1453791052107-5c843da62d97?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1350&q=80" alt="" class="img-fluid rounded shadow-sm"></div>
                    <div class="col-lg-6 pl-lg-1"><img src="https://images.unsplash.com/photo-1475724017904-b712052c192a?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=750&q=80" alt="" class="img-fluid rounded shadow-sm"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}


<script type="text/javascript">

    // Profile Update  API call

    var updateform = document.getElementById('updateProfileform')
    updateform.addEventListener('submit', function(e){
        e.preventDefault()
        console.log('Clicked on save Changes ...')
        updateProfile()
    //    document.getElementById('form-button').classList.add("hidden");

    })


    function updateProfile(){

        var userFormData = {
            'id': {{user.profile.id}},
            'Fullname': null,
            'Email': null,
            'date_of_birth': null,
            'phone': null,
            'address': null,

        }


        userFormData.Fullname = updateform.full_name.value
        userFormData.phone_no = updateform.phne.value
        userFormData.Email = updateform.email.value
        userFormData.date_of_birth = updateform.dob.value
        userFormData.address = updateform.address.value


        console.log('userFormData ka  data  :', userFormData)
        var auth_token = localStorage.getItem('Auth_Token')
        console.log("ye token local se laye hai update profile k liye ",auth_token)
        var url = "http://"+url_link+"/api/Editprofile"
        fetch(url, {
            method:'PUT',
            headers:{
                'Content-Type':'applicaiton/json',

                'X-CSRFToken':csrftoken,
                'Authorization': 'Token '+ auth_token

            },
            body:JSON.stringify(userFormData),

        })
        .then((response) => response.json())
        .then((data) => {
            if (data.status){
               console.log(data)
            }
            else{

              console.log(data)


            }
        })
        ImageUpload()

    }
    function ImageUpload(){
            let input = document.getElementById('profile_pic');
            let DAta = new FormData();
            DAta.append('Profile_pic', input.files[0]);
            DAta.append('id', {{user.profile.id}});
            var auth_token = localStorage.getItem('Auth_Token')
            fetch('http://'+url_link+'/api/Imageupload', {
                method: 'PATCH',
                headers: {
                    'Authorization': 'Token '+ auth_token
                },
                body: DAta
            }).then(response => {
                return response.json();
            })
            .then((data) => {
                if (data.status){
                   console.log(data)
                   window.location.href = "/api/profile/view/"

                }
                else{
                  console.log(data)

                  window.location.href = "/api/profile/view/"
                }
            })
    }

 <!-- For image upload ------------------->

<!--let input = document.getElementById('profile_pic');-->

<!--        let DAta = new FormData();-->
<!--        DAta.append('Profile_pic', input.files[0]);-->
<!--        DAta.append('id', {{user.profile.id}});-->
<!--        var auth_token = localStorage.getItem('Auth_Token')-->
<!--        fetch('http://127.0.0.1:8000/api/Imageupload', {-->
<!--            method: 'PUT',-->
<!--            headers: {-->
<!--                'Authorization': 'Token '+ auth_token-->
<!--            },-->
<!--            body: DAta-->
<!--        }).then(response => {-->
<!--            return response.json();-->
<!--        }).then(data => {-->
<!--            console.log(data);-->
<!--        }).catch((error) => {-->
<!--            console.error('Error:', error);-->
<!--        });-->




<!--- API FOR PRODUCT UPLOAD WHERE IMAGE IS NECESSARY OR REQUIRED ---------------->


  // Product  Update  API call

<!--    var updateform = document.getElementById('updateProfileform')-->
<!--    updateform.addEventListener('submit', function(e){-->
<!--        e.preventDefault()-->
<!--        console.log('Clicked on save Changes ...')-->
<!--        updateProfile()-->
<!--    //    document.getElementById('form-button').classList.add("hidden");-->

<!--    })-->


<!--    function updateProfile(){-->

<!--        let input = document.getElementById('profile_pic');-->

<!--        let DAta = new FormData();-->

<!--        DAta.append('Profile_pic', input.files[0]);-->
<!--        DAta.append('id', {{user.profile.id}});-->
<!--        DAta.append('Fullname', updateform.full_name.value);-->
<!--        DAta.append('Email', updateform.email.value);-->
<!--        DAta.append('date_of_birth', updateform.dob.value);-->
<!--        DAta.append('phone_no', updateform.phne.value);-->
<!--        DAta.append('address', updateform.address.value);-->

<!--        var auth_token = localStorage.getItem('Auth_Token')-->
<!--        fetch('http://127.0.0.1:8000/api/Imageupload', {-->
<!--            method: 'PATCH',-->
<!--            headers: {-->
<!--                'Authorization': 'Token '+ auth_token-->
<!--            },-->
<!--            body: DAta-->
<!--        }).then(response => {-->
<!--            return response.json();-->
<!--        }).then(data => {-->
<!--            console.log(data);-->
<!--        }).catch((error) => {-->
<!--            console.error('Error:', error);-->
<!--        });-->
<!--    }-->




<!---------- END OF PRODUCT API ---------------------------------------------->

</script>

{% endblock %}